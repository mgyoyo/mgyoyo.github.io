<!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="utf-8">
            <title>Project Assignment B</title>
            <script type="text/javascript" src="d3/d3.js"></script>


        </head>
        <style type="text/css">
        .bar {
            fill: #FFD700;
        }

        .bar:hover {
            fill: #FF4500;
        }

        .axis {
            font: 10px sans-serif;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .x.axis path {
            display: none;
        }
        body {
            max-width: 960px;
            margin: auto;

            font-family: Verdana, Helvetica, "sans-serif";
            font-size: 1.2em;
        }

        h1 {
    display: block;
    color: #696969;
    font-family: Impact;
    font-size: 2em;
    margin-top: 0.67em;
    margin-bottom: 0.67em;
    margin-left: 0;
    margin-right: 0;
    font-weight: bold;
}

        h2 {
            color: #C0C0C0;
            font-family: Georgia;
            font-size: 30px;
            font-weight: bold;
            text-align: center;
            text-decoration: underline;
            letter-spacing: -1px;
            line-height: 34px;
            margin: 0;
        }

        h2.title {
            color: #202020;

        }
        h3 {
            color: #D3D3D3;
            font-family: Times;
            font-size: 20px;
            font-weight: bold;
            text-align: left;
            letter-spacing: -1px;
            margin: 5;
        }

        h4 {
            color: #696969;
            font-family: Sans-serif;
            font-size: 15px;
            text-align: left;
            margin: 5;
        }


        .navigation {
          box-sizing: border-box;
          font-size: 12px;
          background-color: whitesmoke;
          overflow: auto;
         padding: 18px 50px;
         position: relative;
         top: 0;
         width: 100%;
         z-index: 999;
         }

        .text{
          font-family: Georgia;
            font-size: 16px;
        }

        .legend {
               padding: 5px;
               font: 10px sans-serif;
               background: yellow;
               box-shadow: 2px 2px 1px #888;
               }

                 .tooltip{
         					position: absolute;
         					text-align: left;
         					width: 200px;
         					height: 150px;
         					padding: 10px;
         					font: 12px sans-serif;
                   font-weight: bold;
         					background: #F8F8FF;
         					border: 20px;
         					border-radius: 10px;
         					pointer-events: none;

         				}

                .tooltip2{
                 position: absolute;
                 text-align: left;
                 width: 120px;
                 height: 50px;
                 padding: 10px;
                 font: 12px sans-serif;
                  font-weight: bold;
                 background: #F8F8FF;
                 border: 20px;
                 border-radius: 10px;
                 pointer-events: none;

               }

        </style>
        <body>
          <div id="headings">
            <h1>Stories about Airbnb in NYC 2017</h1>
          </div>

          <ul class="navigation">
           <li><a href="#svgchart">Airbnb in NYC Price Chart</a></li>
           <li><a href="#svgmap">Location of Airbnb in NYC</a></li>
           <li><a href="#averagechart">Average Price of Airbnb in NYC</a></li>
           <li><a href="#selectMap">Filter the Airbnb in NYC</a></li>
           <li><a href="#useful links">Explainer document & code</a></li>


          </ul>

          <div id="intro to price chart">
            <h4>Dig into the Airbnb price, here is the distribution of the price in NYC 2017. The brush could be uesd to select a dedicated price range.</h4>

          </div>

          <div id="svgchart">
              <h2>Airbnb in NYC Price Chart</h2>
<!--               <svg class='svgchart'> -->
          </div>

          <div id="intro to price map">
            <h4>From the map shows the shows the location, and hangover the mouse their will be details of the place</h4>

          </div>

          <div id="svgmap">
              <h2>Location of Airbnb in NYC</h2>
              <svg class='svgmap'>
          </div>


          <div id="intro to barchat">
            <h4>Based on the average price</h4>

          </div>

          <div id="averagechart">
              <h2>Average Price of Airbnb in NYC</h2>
              <svg class='averagechart'>
          </div>

          <div id="intro to filter map">
            <h4>More secificly, a filter can be used for selection</h4>

          </div>

          <div id="selectMap">
              <h2>Filter the Airbnb in NYC</h2>
              <div id="filterMap">
                <br>Please select the following filter :) <br>
                <div class='radio'>
                  <label class='radio-inline'>
                      Room Type:
                      <input type="radio" id="rmtype" name="rmtype" value="Private room" checked="checked"> Private Room
                  </label>
                  <label class='radio-inline'>
                      <input type="radio" id="rmtype" name="rmtype" value="Shared room"> Shared Room
                  </label>
                  <label class='radio-inline'>
                      <input type="radio" id="rmtype" name="rmtype" value="Entire home/apt"> Entire Apartment
                  </label>
                  <br>
                  <label class='radio-inline'>
                      No. of accommodates:
                      <input type="radio" id="ppl" name="ppl" value="1" checked="checked"> 1
                  </label>
                  <label class='radio-inline'>
                      <input type="radio" id="ppl" name="ppl" value="2"> 2
                  </label>
                  <label class='radio-inline'>
                      <input type="radio" id="ppl" name="ppl" value="3"> 3
                  </label>
                  <label class='radio-inline'>
                      <input type="radio" id="ppl" name="ppl" value="4"> 4
                  </label>
                  <label class='radio-inline'>
                      <input type="radio" id="ppl" name="ppl" value="5"> 5+
                  </label>
              </div>
            </div>
              <svg class='selectMap'>

          </div>

          <div id="dlfile">
            Please feel free to download this dataset to try.
            <a href="/airbnbNYC_2017.csv" download>AirbnbNYC 2017 Dataset</a>
            <br>
            Resourse from: Tom SLEE
          </div>

      </body>



          <script type="text/javascript">
          // Your beautiful D3 code will go here
          //https://www.dashingd3js.com/lessons/geojson

          var margin_chart = {top: 10, right: 30, bottom: 60, left: 80},
              width_chart = 960 - margin_chart.left - margin_chart.right,
              width_brush = width_chart ;
              height_chart = 300 - margin_chart.top - margin_chart.bottom,
              height_brush = height_chart ;


          var margin_map = {top: 0, right: 0, bottom: 0, left: 0},
              width_map = 960 - margin_map.left - margin_map.right,
              height_map = 690 - margin_map.top - margin_map.bottom;

          var margin_averagechart = { top: 20, right: 120, bottom: 30, left: 140 },
            width_averagechart = 960 - margin_averagechart.left - margin_averagechart.right,
            height_averagechart = 500 - margin_averagechart.top - margin_averagechart.bottom;

          var margin_selectmap = { top: 0, right: 0, bottom: 0, left: 0 },
              width_selectmap = 960 - margin_selectmap.left - margin_selectmap.right,
              height_selectmap = 690 - margin_selectmap.top - margin_selectmap.bottom;

          var svgchart = d3.select("#svgchart")
                          .append("svg")
                          .attr("width", width_chart + margin_chart.left + margin_chart.right)
                          .attr("height", height_chart + margin_chart.top + margin_chart.bottom)
                          .append("g")
                          .attr("transform",
                                  "translate(" + margin_chart.left + "," + margin_chart.top + ")");

          var svgmap = d3.select("#svgmap")
                        .append("svg")
                        .attr("width", width_map)
                        .attr("height", height_map);


          var svgAvgChart = d3.select("#averagechart")
                            .append("svg")
                            .attr("width", width_averagechart + margin_averagechart.left + margin_averagechart.right)
                            .attr("height", height_averagechart + margin_averagechart.top + margin_averagechart.bottom)
                            .append("g")
                            .attr("transform", "translate(" + margin_averagechart.left + "," + margin_averagechart.top + ")");




          var svgselectMap = d3.select("#selectMap")
                                .append("svg")
                                .attr("width", width_selectmap)
                                .attr("height", height_selectmap);

          var projectionSelect = d3.geoMercator().scale(65000).translate([width_selectmap /2, height_selectmap/2]).center([-74.0, 40.7]);
          var pathSelect = d3.geoPath().projection(projectionSelect);

          var projection = d3.geoMercator().scale(65000).translate([width_map /2, height_map/2]).center([-74.0, 40.7]);
          var path = d3.geoPath().projection(projection);




         // Load in my states data!
            d3.csv("airbnbNYC_2017.csv", function(data) {
               //----------draw histogram------------
               d3.json("boroughs.geojson", function(json) {

                //map
                // Bind the data to the SVG and create one path per GeoJSON feature
                    svgmap.selectAll("path")
                      .data(json.features)
                      .enter()
                      .append("path")
                      .attr("d", path)
                      .style("stroke", "#fff")
                      .style("stroke-width", "1")
                      .style("fill", function(d) {
                          // Get data value
                          var value = d.properties.BoroName;

                          if (value == "Staten Island") {
                            return "rgb(107,174,214)";
                          } else if (value == "Bronx") {
                            return "rgb(213,222,217)";
                          } else if (value == "Manhattan"){
                            return "rgb(222,235,247)";
                          }else if (value == "Brooklyn"){
                            return "rgb(198,219,239)";
                          }else if (value == "Queens"){
                            return "rgb(158,202,225)";
                          }
                        });

                        //add namas

                        d3.csv("cities.csv", function(error, data) {
                           svgmap.selectAll("text")
                                 .append("g")
                                 .data(data)
                                 .enter()
                                 .append("text")
                                 .attr("x", function(d){
                                   return projection([d.lon, d.lat])[0];
                                 })
                                 .attr("y", function(d){
                                   return projection([d.lon, d.lat])[1];
                                 })
                                 .attr("dy", -7)
                                 .style("fill", "black")
                                 .style("opacity", .9)
                                 .style("stroke","white")
                                 .style("stroke-opacity", .4)
                                 .attr("text-anchor", "middle")
                                 .style("font-size", "16px")
                                 .text(function(d) {return d.city;});
                              //   .call(zoom);
                              //add lengend:
                                                            var legend_1 = svgmap.append("g")
                                                              .attr("class", "legend")
                                                               //.attr("x", w - 65)
                                                               //.attr("y", 25)
                                                               //.attr("height", 100)
                                                               //.attr("width", 100)
                                                               .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                             legend_1.selectAll('rect')
                                                              .data(data)
                                                              .enter()
                                                             .append("rect")
                                                              .attr("x", 100)
                                                              .attr("y", 30)
                                                              .attr("width", 30)
                                                              .attr("height", 20)
                                                              .style("fill", "#FFF8DC")
                                                              .style("opacity", .7);

                                                            legend_1.selectAll('text')
                                                             .data(brushedData)
                                                             .enter()
                                                             .append("text")
                                                             .attr("x",40)
                                                             .attr("y",44)
                                                             .text("Price: 0 - 50");

                                                             var legend_2 = svgmap.append("g")
                                                               .attr("class", "legend")
                                                                //.attr("x", w - 65)
                                                                //.attr("y", 25)
                                                                //.attr("height", 100)
                                                                //.attr("width", 100)
                                                                .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                              legend_2.selectAll('rect')
                                                               .data(data)
                                                               .enter()
                                                              .append("rect")
                                                               .attr("x", 100)
                                                               .attr("y", 60)
                                                               .attr("width", 30)
                                                               .attr("height", 20)
                                                               .style("fill", "#FFE4C4")
                                                               .style("opacity", .7);

                                                             legend_2.selectAll('text')
                                                              .data(data)
                                                              .enter()
                                                              .append("text")
                                                              .attr("x",40)
                                                              .attr("y",74)
                                                              .text("Price: 50 - 100");


                                                              var legend_3 = svgmap.append("g")
                                                                .attr("class", "legend")
                                                                 //.attr("x", w - 65)
                                                                 //.attr("y", 25)
                                                                 //.attr("height", 100)
                                                                 //.attr("width", 100)
                                                                 .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                               legend_3.selectAll('rect')
                                                                .data(data)
                                                                .enter()
                                                               .append("rect")
                                                                .attr("x", 100)
                                                                .attr("y", 90)
                                                                .attr("width", 30)
                                                                .attr("height", 20)
                                                                .style("fill", "#FFA07A")
                                                                .style("opacity", .7);

                                                              legend_3.selectAll('text')
                                                               .data(brushedData)
                                                               .enter()
                                                               .append("text")
                                                               .attr("x",40)
                                                               .attr("y",104)
                                                               .text("Price: 100 - 200");

                                                               var legend_4 = svgmap.append("g")
                                                                 .attr("class", "legend")
                                                                  //.attr("x", w - 65)
                                                                  //.attr("y", 25)
                                                                  //.attr("height", 100)
                                                                  //.attr("width", 100)
                                                                  .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                                legend_4.selectAll('rect')
                                                                 .data(data)
                                                                 .enter()
                                                                .append("rect")
                                                                 .attr("x", 100)
                                                                 .attr("y", 120)
                                                                 .attr("width", 30)
                                                                 .attr("height", 20)
                                                                 .style("fill", "#FF6347")
                                                                 .style("opacity", .7);

                                                               legend_4.selectAll('text')
                                                                .data(brushedData)
                                                                .enter()
                                                                .append("text")
                                                                .attr("x",40)
                                                                .attr("y",134)
                                                                .text("Price: 200 - 500");

                                                                var legend_5 = svgmap.append("g")
                                                                  .attr("class", "legend")
                                                                   //.attr("x", w - 65)
                                                                   //.attr("y", 25)
                                                                   //.attr("height", 100)
                                                                   //.attr("width", 100)
                                                                   .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                                 legend_5.selectAll('rect')
                                                                  .data(data)
                                                                  .enter()
                                                                 .append("rect")
                                                                  .attr("x", 100)
                                                                  .attr("y", 150)
                                                                  .attr("width", 30)
                                                                  .attr("height", 20)
                                                                  .style("fill", "#FF4500")
                                                                  .style("opacity", .7);

                                                                legend_5.selectAll('text')
                                                                 .data(brushedData)
                                                                 .enter()
                                                                 .append("text")
                                                                 .attr("x",40)
                                                                 .attr("y",164)
                                                                 .text("Price: 500 - 700");

                                                                 var legend_6 = svgmap.append("g")
                                                                   .attr("class", "legend")
                                                                    //.attr("x", w - 65)
                                                                    //.attr("y", 25)
                                                                    //.attr("height", 100)
                                                                    //.attr("width", 100)
                                                                    .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                                  legend_6.selectAll('rect')
                                                                   .data(data)
                                                                   .enter()
                                                                  .append("rect")
                                                                   .attr("x", 100)
                                                                   .attr("y", 180)
                                                                   .attr("width", 30)
                                                                   .attr("height", 20)
                                                                   .style("fill", "#800000")
                                                                   .style("opacity", .7);

                                                                 legend_6.selectAll('text')
                                                                  .data(brushedData)
                                                                  .enter()
                                                                  .append("text")
                                                                  .attr("x",40)
                                                                  .attr("y",194)
                                                                  .text("Price > 700");

                               });



                      data.forEach(function(d){
                          d.price = parseInt(d.price);
                        });

                         groupPrice = d3.nest()
                                      .key(function(d) {return d.price})
                                      .rollup(function (v) {return v.length})
                                      .entries(data)
                                      ;
                        console.log(groupPrice);

                        groupPrice.forEach(function(d){
                          d.key = parseInt(d.key);
                        });


                var brush = d3.brushX()
                              .extent([[0, 0], [width_brush, height_brush]])
                              .on("brush", brushed)
                              .on("end", updateData);
                              ;

                function brushed(){
                  if (d3.event.selection != null) {
                      range = d3.brushSelection(this)
                              .map(x.invert);
                  }
                }

              //make new array for selected data
              function updateData(){
                brushedData = [];

                  for (var i = 0 ; i < data.length; i++){
                    if (data[i].price >= range[0] && data[i].price <= range[1]){
                        brushedData.push(data[i]);
                    }
                  };
                  console.log(brushedData);
                  drawCircle();
              }


                var x = d3.scaleLinear()
                          .domain([0, d3.max(groupPrice, function(d) { return d.key; })])
                          .range([0, width_chart]);

                var y = d3.scaleLinear()
                          .range([height_chart, 0])
                          .domain([0, d3.max(groupPrice, function(d) { return d.value; })]);


                // append the bar rectangles to the svg element
                svgchart.selectAll("rect")
                    .data(groupPrice)
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .style("fill", "rgb(107,174,214)" )
                    .attr("x", function (d) {return x(d.key) })
                    .attr("y", function (d){ return y(d.value)})
                    .attr("width", 1)
                    .attr("height", function(d) { return height_chart - y(d.value); });




                 var xAxis = d3.axisBottom(x);
                 var yAxis = d3.axisLeft(y);

                 //add brush area box
                 svgchart.append("g")
                      .attr("class", "brush")
                      .call(brush)
                      .call(brush.move, [0, 50].map(x));

                // add the x Axis
                svgchart.append("g")
                    .attr("class", "xAxis")
                    .attr("transform", "translate(0," + height_chart + ")")
                    .call(xAxis);


                // add the y Axis
                svgchart.append("g")
                    .attr("class", "yAxis")
                    .call(yAxis);

                svgchart
                    .append("text")
                    .attr("transform", "translate(-35," + (height_chart + margin_chart.bottom)/1.5 + ") rotate(-90)")
                    .text("# of Aibnb");

                svgchart
                    .append("text")
                    .attr("transform", "translate(" + (width_chart / 2) + "," + (height_chart + margin_chart.bottom) + ")")
                    .text("Price ($)");




                function drawCircle(){
                  //remove all circle first
                  svgmap.selectAll("circle").remove();
                  //console.log(bdata);
                  //draw circle
                  var circles = svgmap.selectAll("circle")
                                .data(brushedData) //change to range of new data
                                .enter()
                                .append("circle")
                                .attr("cx", function(d) {
                                  return projection([d.longitude, d.latitude])[0];
                                })
                                .attr("cy", function(d) {
                                  return projection([d.longitude, d.latitude])[1];
                                })
                                //.attr("class", "non_brushed")
                                .attr("r", 3)
                                .style("fill",function(d) {
                                  // Get data value
                                  var value = d.price;

                                  if (value  < 50) {
                                    return "#FFF8DC";
                                  } else if (value < 100) {
                                    return "#FFE4C4";
                                  } else if (value < 200){
                                    return "#FFA07A";
                                  } else if (value < 500){
                                    return "#FF6347"
                                  } else if (value < 700){
                                    return "#FF4500"
                                  }else {
                                    return "#800000";
                                  }
                                })
                                  .style("opacity", 0.85)
                                  //tooltips
                                  .on("mouseover", function(d){
                                    tooltip.html("<br/>"+'Price: '+'$'+d.price+' USD'+"<br/>"+'Rate: '+d.overall_satisfaction+"<br/>"+'Type: '+d.property_type+"<br/>"+'Bedrooms: '+d.bedrooms +"<br/>"+'Guests: '+d.accommodates+"<br/>"+'Neighborhood: '+d.neighborhood+"<br/>"+'More info: '+d.name)
                                    .style("left", d3.event.pageX + 20+ "px")
                                .style("top", d3.event.pageY + 20 + "px")
                                .style("opacity", 0.8)
                                d3.select(this).transition()
                                        .duration(150)
                   })
                   .on("mouseout", function(){
                        d3.select(this).transition()
                                        .duration(150)
                        tooltip.style("opacity", 0)
                   });


                                   var tooltip = d3.select("body")
                                                     .append("div")
                                                     .attr("class", "tooltip")
                                                     .style("opacity", 0)

                }




            // Group data by neghbourhood
            var groupByNeghbour = d3.nest()
                .key(function (d) { return d.borough; })
                .entries(data);

                console.log(groupByNeghbour);

            groupByNeghbour.forEach(group => {
                group.average = d3.mean(group.values, function (d) {
                    return d.price;
                });
            });

            var xAvgChart = d3.scaleBand()
                .rangeRound([0, width_averagechart], .1)
                .paddingInner(0.1);

            var yAvgChart = d3.scaleLinear()
                .range([height_averagechart, 0]);

            var xAvgChartAxis = d3.axisBottom()
                .scale(xAvgChart);

            var yAvgChartAxis = d3.axisLeft()
                .scale(yAvgChart);

            // Draw Barchar
            xAvgChart.domain(groupByNeghbour.map(function (d) { return d.key; }));
            yAvgChart.domain([0, d3.max(groupByNeghbour, function (d) { return d.average; })]);

            svgAvgChart.append("g")
                .attr("class", "xAvgChart")
                .attr("transform", "translate(0," + height_averagechart + ")")
                .text("Boroughs")
                .call(xAvgChartAxis);

            svgAvgChart.append("g")
                .attr("class", "yAvgChart")
                .call(yAvgChartAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Price");

            svgAvgChart.selectAll(".bar")
                .data(groupByNeghbour)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function (d) { return xAvgChart(d.key); })
                .attr("width", xAvgChart.bandwidth())
                .attr("y", function (d) { return yAvgChart(d.average); })
                .attr("height", function (d) { return height_averagechart - yAvgChart(d.average); })
                //tooltip
                .on("mouseover", function(d){
                  tooltip2.html("<br/>"+'Price: '+'$'+d.average.toFixed(2)+' USD')
                  .style("left", d3.event.pageX + 20+ "px")
              .style("top", d3.event.pageY + 20 + "px")
              .style("opacity", 0.8)
              d3.select(this).transition()
                      .duration(150)
 })
 .on("mouseout", function(){
      d3.select(this).transition()
                      .duration(150)
      tooltip2.style("opacity", 0)
 });


                 var tooltip2 = d3.select("body")
                                   .append("div")
                                   .attr("class", "tooltip2")
                                   .style("opacity", 0)


 //selection map
                    svgselectMap.selectAll("path")
                        .data(json.features)
                        .enter()
                        .append("path")
                        .attr("d", pathSelect)
                        .style("stroke", "#fff")
                        .style("stroke-width", "1")
                        .style("fill", function (d) {
                            // Get data value
                            var value = d.properties.BoroName;

                            if (value == "Staten Island") {
                                return "rgb(107,174,214)";
                            } else if (value == "Bronx") {
                                return "rgb(213,222,217)";
                            } else if (value == "Manhattan") {
                                return "rgb(222,235,247)";
                            } else if (value == "Brooklyn") {
                                return "rgb(198,219,239)";
                            } else if (value == "Queens") {
                                return "rgb(158,202,225)";
                            }
                        });

						//add name
						d3.csv("cities.csv", function(error, data) {
							 svgselectMap.selectAll("text")
										 .append("g")
										 .data(data)
										 .enter()
										 .append("text")
										 .attr("x", function(d){
											 return projection([d.lon, d.lat])[0];
										 })
										 .attr("y", function(d){
											 return projection([d.lon, d.lat])[1];
										 })
										 .attr("dy", -7)
										 .style("fill", "black")
										 .style("opacity", .9)
										 .style("stroke","white")
										 .style("stroke-opacity", .4)
										 .attr("text-anchor", "middle")
										 .style("font-size", "16px")
										 .text(function(d) {return d.city;});
									//   .call(zoom);
                  //add lengend:
                                                var legend_1 = svgselectMap.append("g")
                                                  .attr("class", "legend")
                                                   //.attr("x", w - 65)
                                                   //.attr("y", 25)
                                                   //.attr("height", 100)
                                                   //.attr("width", 100)
                                                   .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                 legend_1.selectAll('rect')
                                                  .data(data)
                                                  .enter()
                                                 .append("rect")
                                                  .attr("x", 100)
                                                  .attr("y", 30)
                                                  .attr("width", 30)
                                                  .attr("height", 20)
                                                  .style("fill", "#FFF8DC")
                                                  .style("opacity", .7);

                                                legend_1.selectAll('text')
                                                 .data(data)
                                                 .enter()
                                                 .append("text")
                                                 .attr("x",40)
                                                 .attr("y",44)
                                                 .text("Price: 0 - 50");

                                                 var legend_2 = svgselectMap.append("g")
                                                   .attr("class", "legend")
                                                    //.attr("x", w - 65)
                                                    //.attr("y", 25)
                                                    //.attr("height", 100)
                                                    //.attr("width", 100)
                                                    .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                  legend_2.selectAll('rect')
                                                   .data(data)
                                                   .enter()
                                                  .append("rect")
                                                   .attr("x", 100)
                                                   .attr("y", 60)
                                                   .attr("width", 30)
                                                   .attr("height", 20)
                                                   .style("fill", "#FFE4C4")
                                                   .style("opacity", .7);

                                                 legend_2.selectAll('text')
                                                  .data(data)
                                                  .enter()
                                                  .append("text")
                                                  .attr("x",40)
                                                  .attr("y",74)
                                                  .text("Price: 50 - 100");


                                                  var legend_3 = svgselectMap.append("g")
                                                    .attr("class", "legend")
                                                     //.attr("x", w - 65)
                                                     //.attr("y", 25)
                                                     //.attr("height", 100)
                                                     //.attr("width", 100)
                                                     .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                   legend_3.selectAll('rect')
                                                    .data(data)
                                                    .enter()
                                                   .append("rect")
                                                    .attr("x", 100)
                                                    .attr("y", 90)
                                                    .attr("width", 30)
                                                    .attr("height", 20)
                                                    .style("fill", "#FFA07A")
                                                    .style("opacity", .7);

                                                  legend_3.selectAll('text')
                                                   .data(data)
                                                   .enter()
                                                   .append("text")
                                                   .attr("x",40)
                                                   .attr("y",104)
                                                   .text("Price: 100 - 200");

                                                   var legend_4 = svgselectMap.append("g")
                                                     .attr("class", "legend")
                                                      //.attr("x", w - 65)
                                                      //.attr("y", 25)
                                                      //.attr("height", 100)
                                                      //.attr("width", 100)
                                                      .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                    legend_4.selectAll('rect')
                                                     .data(data)
                                                     .enter()
                                                    .append("rect")
                                                     .attr("x", 100)
                                                     .attr("y", 120)
                                                     .attr("width", 30)
                                                     .attr("height", 20)
                                                     .style("fill", "#FF6347")
                                                     .style("opacity", .7);

                                                   legend_4.selectAll('text')
                                                    .data(data)
                                                    .enter()
                                                    .append("text")
                                                    .attr("x",40)
                                                    .attr("y",134)
                                                    .text("Price: 200 - 500");

                                                    var legend_5 = svgselectMap.append("g")
                                                      .attr("class", "legend")
                                                       //.attr("x", w - 65)
                                                       //.attr("y", 25)
                                                       //.attr("height", 100)
                                                       //.attr("width", 100)
                                                       .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                     legend_5.selectAll('rect')
                                                      .data(data)
                                                      .enter()
                                                     .append("rect")
                                                      .attr("x", 100)
                                                      .attr("y", 150)
                                                      .attr("width", 30)
                                                      .attr("height", 20)
                                                      .style("fill", "#FF4500")
                                                      .style("opacity", .7);

                                                    legend_5.selectAll('text')
                                                     .data(data)
                                                     .enter()
                                                     .append("text")
                                                     .attr("x",40)
                                                     .attr("y",164)
                                                     .text("Price: 500 - 700");

                                                     var legend_6 = svgselectMap.append("g")
                                                       .attr("class", "legend")
                                                        //.attr("x", w - 65)
                                                        //.attr("y", 25)
                                                        //.attr("height", 100)
                                                        //.attr("width", 100)
                                                        .attr("transform", function (d, i) { return "translate(0," + i * 20 + ")"; });

                                                      legend_6.selectAll('rect')
                                                       .data(data)
                                                       .enter()
                                                      .append("rect")
                                                       .attr("x", 100)
                                                       .attr("y", 180)
                                                       .attr("width", 30)
                                                       .attr("height", 20)
                                                       .style("fill", "#800000")
                                                       .style("opacity", .7);

                                                     legend_6.selectAll('text')
                                                      .data(data)
                                                      .enter()
                                                      .append("text")
                                                      .attr("x",40)
                                                      .attr("y",194)
                                                      .text("Price > 700");
									 });



            var groupRoomType = d3.nest()
                .key(function (d) { return d.room_type })
                .entries(data);

            // Set default value
            var rmtype_now = "Private room";
            var ppl_now = 1;

            // Add listener
            d3.selectAll("#rmtype").on("change", radioChange);
            d3.selectAll("#ppl").on("change", radioChange);

            function radioChange() {
                if (this.id == "rmtype") {
                    // Room type change
                    rmtype_now = this.value;
                } else if (this.id == "ppl") {
                    // People no. change
                    ppl_now = parseInt(this.value);
                }
                refreshData();
                // console.log('rmtype:', rmtype_now, 'ppl:', ppl_now);
            }

            function refreshData() {
                // Group Room Type
                var groupedRm = groupRoomType.find(x => x.key === rmtype_now).values;

                // Filter no.
                var filterNo = groupedRm.filter(x => x.accommodates >= ppl_now);

                drawCircleSelect(filterNo);
            }
            refreshData();







            function drawCircleSelect(daten) {
                //remove all circle first
                svgselectMap.selectAll("circle").remove();
                //console.log(bdata);
                //draw circle
                var circles = svgselectMap.selectAll("circle")

                    .data(daten) //change to range of new data
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) {
                        return projectionSelect([d.longitude, d.latitude])[0];
                    })
                    .attr("cy", function (d) {
                        return projectionSelect([d.longitude, d.latitude])[1];
                    })
                    //.attr("class", "non_brushed")
                    .attr("r", 2)
                    .style("fill", function (d) {
                        // Get data value
                        var value = d.price;

                        if (value  < 50) {
                          return "#FFF8DC";
                        } else if (value < 100) {
                          return "#FFE4C4";
                        } else if (value < 200){
                          return "#FFA07A";
                        } else if (value < 500){
                          return "#FF6347"
                        } else if (value < 700){
                          return "#FF4500"
                        }else {
                          return "#800000";
                        }
                    })
                    .style("opacity", 0.85)

                    //tooltips
                    .on("mouseover", function(d){
                      tooltip.html("<br/>"+'Price: '+'$'+d.price+' USD'+"<br/>"+'Rate: '+d.overall_satisfaction+"<br/>"+'Type: '+d.property_type+"<br/>"+'Bedrooms: '+d.bedrooms +"<br/>"+'Guests: '+d.accommodates+"<br/>"+'Neighborhood: '+d.neighborhood+"<br/>"+'More info: '+d.name)
                      .style("left", d3.event.pageX + 20+ "px")
                  .style("top", d3.event.pageY + 20 + "px")
                  .style("opacity", 0.8)
                  d3.select(this).transition()
                          .duration(150)
          })
          .on("mouseout", function(){
          d3.select(this).transition()
                          .duration(150)
          tooltip.style("opacity", 0)
          });


                     var tooltip = d3.select("body")
                                       .append("div")
                                       .attr("class", "tooltip")
                                       .style("opacity", 0)

            }

        });
      });

            </script>
            <hr>
            <div id="useful links">
              <h3>Explainer Page</h3>
                <p style="color:grey;">The story behind the project: <span class="w3-opacity"><a href="explainer.html" target="_blanck">Explainer: Telling the Stories Behind Data</a></span></p>





              <h3>Github Repo</h3>
              <p style="color:grey;">The code of story page and explainer page: <span class="w3-opacity"><a href="https://github.com/ninomiyaonion/project-assignment-B" target="_blank">project-assignment-B</a></span></p>
            </div>
<!--         </body> -->
</html>
